var CustomerFeedback={},CaptchaCallback=function(){jQuery(".g-recaptcha").each(function(e,t){grecaptcha.render(t,{sitekey:feedback.site_key})})};CustomerFeedback=CustomerFeedback||{},CustomerFeedback.Form=CustomerFeedback.Form||{},CustomerFeedback.Form=function(e){function t(){this.handleEvents()}return t.prototype.handleEvents=function(){e('[data-action="customer-feedback-submit-response"]').on("click",function(t){t.preventDefault(),$target=e(t.target).parents(".customer-feedback-container"),e(t.target).html('<i class="spinner spinner-dark"></i>');var a=$target.find('[name="customer-feedback-post-id"]').val(),n=e(t.target).val();this.submitInitialResponse($target,a,n)}.bind(this)),e('[data-action="customer-feedback-submit-comment"]').on("click",function(t){t.preventDefault(),$target=e(t.target).parents(".customer-feedback-container"),$target.find('[name="customer-feedback-comment-text"]').removeClass("invalid"),$target.find("div.danger").remove();var a="comment",n=$target.find('[name="customer-feedback-answer-id"]').val(),c=$target.find('[name="customer-feedback-post-id"]').val(),r=$target.find('[name="customer-feedback-comment-text"]').val(),i=$target.find('[name="g-recaptcha-response"]').val(),o=$target.find('[name="customer-feedback-comment-email"]').val(),s=$target.find('[name="customer-feedback-comment-email"]').prop("required"),m=$target.find('[name="customer-feedback-comment-topic"]:checked').val(),d=!0;return e("div.customer-feedback-topics").is(":visible")&&!m&&($target.find('[name="customer-feedback-comment-topic"]:last').parent().after('<div class="clearfix"></div><div style="margin-top: 5px;" class="notice notice-sm danger">'+feedback.select_topic+"</div>"),d=!1),r.length<15&&($target.find('[name="customer-feedback-comment-text"]').addClass("invalid"),$target.find('[name="customer-feedback-comment-text"]').after('<div class="clearfix"></div><div style="margin-top: 5px;" class="notice notice-sm danger">'+feedback.comment_min_characters+"</div>"),d=!1),0===o.length&&1==s&&(d=!1),!!d&&(e(t.target).html('<i class="spinner spinner-dark"></i>'),void this.submitComment($target,n,c,a,r,o,i,m))}.bind(this)),e('[name="customer-feedback-comment-topic"]').change(function(t){$target=e(t.target).parents(".customer-feedback-container"),$target.find("div.customer-feedback-topics div.danger").remove(),e(t.target).attr("topic-description")?$target.find(".topic-description").show().html('<span class="text-sm">'+e(t.target).attr("topic-description")+"</span>"):$target.find(".topic-description").hide(),e(t.target).attr("feedback-capability")?$target.find('[name="customer-feedback-comment-email"]').prop("required",!0).parent().show():$target.find('[name="customer-feedback-comment-email"]').prop("required",!1).parent().hide()})},t.prototype.submitComment=function(t,a,n,c,r,i,o,s){var m={action:"submit_comment",postid:n,comment:r,answerid:a,commenttype:c,email:i,captcha:o,topicid:s},d=t;e.post(ajaxurl,m,function(e){"true"==e?(d.find(".customer-feedback-comment").remove(),d.find(".customer-feedback-thanks").show()):(d.find(".customer-feedback-comment").remove(),d.find(".customer-feedback-error").show())})},t.prototype.submitInitialResponse=function(t,a,n){var c=t,r={action:"submit_response",postid:a,answer:n};e.post(ajaxurl,r,function(e){"yes"==r.answer&&!isNaN(parseFloat(e))&&isFinite(e)&&(c.find(".customer-feedback-topics").hide(),c.find('[name="customer-feedback-comment-email"]').parent().hide(),c.find('[name="customer-feedback-post-id"]').after('<input type="hidden" name="customer-feedback-answer-id" value="'+e+'">'),c.find(".customer-feedback-answers").remove(),c.find(".customer-feedback-comment").show().find(".feedback-label-yes").show()),"no"==r.answer&&!isNaN(parseFloat(e))&&isFinite(e)&&(c.find('[name="customer-feedback-post-id"]').after('<input type="hidden" name="customer-feedback-answer-id" value="'+e+'">'),c.find(".customer-feedback-answers").remove(),c.find(".customer-feedback-comment").show().find(".feedback-label-no").show())})},new t}(jQuery);